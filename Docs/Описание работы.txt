0. Измерение текущего состава газовой смеси путем измерения напряжения с датчков концентрации CO2 и O2 и датчик давления СО2 и O2. 

Пересчет концентрации в % из кода АЦП происходит по формуле:
	k * (adc_code / 4095 * 3.3) + b, где
	k - множитель концентрации,
	b - смещение концентрации.
	
Пересчет давления в Бары из кода АЦП происходит по формуле:
	k * (adc_code / 4095 * 3.3) + b, где
	k - множитель давления,
	b - смещение давления.
	

1. Составить план создания газовой смеси. План состоит из 4х шагов:
	1. Разрешение работы клапана N2. Если разница между целевой концентраций O2 и измеренной больше 0.1%, рассчитать время работы клапана N2 в мс, иначе работа клапана N2 неактивна. Расчет времени работы клапана N2 в п. 6.
	2. Пауза 60 сек на смешение газов. Все клапаны не активны.
	3. Разрешение работы клапана CO2. Если разница между целевой концентрацией CO2 и измеренной больше 0.1%, рассчитать время работы клапана CO2 в мс, иначе работа клапана CO2 не активна. Расчет времени работы клапана CO2 в п. 7.
	4. Пауза 60 сек на смешение газов. Все клапаны не активны.
	
2. Ожидание команды OperationCommand по ModBus. Если команда пришла выполняется п.3, иначе п.0.

3. Если в текущем шаге разрешена работа клапана, подается управляющее воздействие на соответствующий клапан. В противном случае клапан остается закрыт. Управляющее воздействие это сигнал ШИМ, частотой 1кГц, и скважностью, задаваемой в параметре Valve1(для N2) и Valve2(для СО2).

4. Шаг плана завершается, если выполняется одно из условий:
	1. Клапан активен и разница между целевой концентрацией газа и измеренной оказывается меньше, чем 0.05%.
	2. Истекло рассчитанное для этого шага время работы клапана в мс.
	
5. Если текущий шаг плана не превышает 4, переходим к выполнению следующего шага в соотвествии с п.3. Если текущий шаг равен 4, пересоздаем план в соответствии с п.1.

Volume - объем в литрах
TargetO2 - целевая концентрация О2 в %
ReqO2_L - целевая концентрация О2 в литрах
TargetAir_L - целевая концентрация О2 в литрах
CurrentO2 - измеренная концентрация О2 в %

6. Расчет времени работы клапана N2 в мс:
	duty_ms[мс] = TargetVN2[л] / Outake[л/c] * KoefN2 / 100[%] * 1000, т.е
	мс = литры / (литры/с) * Коеф_клапана / 100% * 1000(мс в сек),
	где, 
	TargetVN2 = Volume[л] - ReqAir[л] - целевая концентрация в литрах,
	ReqAir[л] = Volume[л] * TargetO2[%] / CurrentO2[%] - целевая концентрация воздуха в литрах
	Outake = выход клапана в литр/с.
	
7. Расчет времени работы клапана CO2 в мс:
	duty_ms[мс] = TargetVCO2[л] / Outake[л/c] * KoefCO2 / 100[%] * 1000, т.е
	мс = литры / (литры/с) * Коеф_клапана / 100% * 1000(мс в сек),
	где, 
	TargetVCO2 = Volume[л] * (TargetСO2[%] - CurrentСO2[%]) / 100[%] - целевая концентрация в литрах,
	Outake = выход клапана в литр/с.